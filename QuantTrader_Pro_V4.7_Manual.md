# QuantTrader Pro V4.7 实操手册

> **警告**：本系统包含极高风险的交易预设（狂暴模式）。请务必在充分理解风险的前提下使用，并严格遵守本手册的风控建议。

---

## 🚀 1. 核心模式介绍

QuantTrader Pro V4.7 引入了“分级博弈”理念，根据资金量和风险偏好提供四种战术层级。

### 👹 Lv.0 狂暴模式 (Berserk Mode)
**定位**：小资金博暴利，仿竞品高频刷单策略。
- **适用场景**：亚盘震荡、市场垃圾时间，或者使用美分账户 (Cent) 进行极限测试。
- **核心逻辑**：
    - **极密网格**：网格间距仅 **35 微点** (0.35倍)，对波动极其敏感。
    - **指数加仓**：无衰减的指数加仓 (1.3倍+)，由 `ProductPresets.mqh` 控制。
    - **阉割 ATR**：强制关闭 ATR 动态波动率保护，无视行情波动强制开仓。
    - **智能对冲**：**7层** 触发全向对冲（用户自定义）。

### 🛡️ Lv.1 - Lv.4 常规模式
- **Lv.1 实验室**：激进测试。
- **Lv.2 特种兵**：稳健单兵，适合大多数标准账户。
- **Lv.3 指挥官**：多品种对冲组合。
- **Lv.4 鲸鱼**：机构级保守策略，本金保护优先。

---

## ⚙️ 2. 详细配置指南

要在 MT4 中启动 QuantTrader Pro，请按以下步骤配置参数：

### 2.1 启动狂暴模式
在 EA 属性面板中设置：
1.  **InpUsePreset**: `true` (使用预设)
2.  **InpCapitalTier**: 选择 `TIER_BERSERK` (或手动输入 0)
    *   *注：此时下方的 ATR 参数、马丁倍率等将被狂暴模式的强制参数覆盖。*
3.  **InpProductType**: 选择对应的品种 (推荐 `PRODUCT_GOLD` 或 `PRODUCT_EURUSD`)。
    *   *注：狂暴模式主要针对黄金 (XAUUSD) 设计。*

### 2.2 启动常规模式
1.  **InpCapitalTier**: 选择 `TIER_SOLDIER` (特种兵) 或其他层级。
2.  **InpAutoTier**: 如果设为 `true`，系统主要根据余额自动判定层级，会覆盖手动选择。

---

## 🧩 3. 智能分级对冲 (Smart Cross Hedging)

V4.7 的核心大脑。系统不再只是傻瓜式地单边止盈，而是会根据局势判断是“贪婪”还是“保命”。

### 逻辑详解

| 特性 | 👹 狂暴模式 (Berserk) | 🛡️ 常规模式 (Normal) |
| :--- | :--- | :--- |
| **触发条件** | **单边持仓 ≥ 7 层** (您已自定义) | **单边持仓 ≥ 8 层** |
| **对冲目标** | **总账盈利 > $1.0** (只要赚钱就跑) | **总账盈利 > $5.0** (保本救援) |
| **憋单策略** | **有**。3层以上被套若未盈利，暂停小额止盈，等待全向解套。 | **无**。各自为止，互不干扰。 |
| **执行动作** | 触发后全平多空双边，并重置风控状态。 | 触发后全平多空双边。 |

> **实战意义**：
> *   在**狂暴模式**下，如果行情反向拉升到 7 层，系统会停止单边的小止盈，全神贯注等待一个回调。只要账户总浮盈变成正数（哪怕只赚 1 块钱），立马全平跑路，防止单边爆仓。

---

## 🚨 4. 风控与重置操作

### 4.1 自动风控
系统内置三重熔断机制：
1.  **一级熔断 (硬止损)**：净值低于本金的 `InpEquityStopPct`% (默认 25%) 时，**强制清仓并关机**。
2.  **二级熔断 (日亏损)**：当日累计亏损 + 当前浮亏 > `InpDailyLossPct`% (默认 5%) 时，**清仓并暂停**。
3.  **三级熔断 (技术性)**：单边层数达到 12 层或浮亏点数过大，**砍掉单边**。

### 4.2 手动重置 (Resurrection)
当系统触发 **一级** 或 **二级** 熔断进入“暂停”或“关机”状态后，面板上的大按钮会变红。

**如果在此刻想要强行恢复交易：**
1.  点击面板上的 **红色状态按钮**（显示“已触发熔断...”或“已停机”）。
2.  **系统反馈**：
    *   按钮变回灰色（系统已暂停）。
    *   日志输出：`🛡️ 风控状态已重置！快照基准盈利: XXX`。
3.  **再次点击** 该按钮。
    *   按钮变蓝（系统运行中）。
    *   **关键机制**：此时系统会忽略因为熔断而产生的当日亏损记录，从**当前时刻**开始重新计算风控指标。

---

## 📝 5. 常见问题 (Q&A)

**Q: 为什么开了狂暴模式，面板显示的网格间距还是 35？波动很大时不应该变大吗？**
A: **不应该。** 这是 V4.6 修复的特性。狂暴模式强制阉割了 ATR 动态间距，目的是为了在任何行情下都保持高频刷单。如果变大就不是“狂暴”了。

**Q: 为什么达到 7 层后，本来以前会止盈的单子不平仓了？**
A: 这是 **V4.7 的憋单逻辑**生效了。因为触发了对冲警戒线，系统认为此时“保命/解套”比“赚小钱”更重要，所以暂停了单边止盈，积蓄筹码等待一次性全平。

**Q: 点击重置按钮后，会马上开单吗？**
A: 点击重置只是清除了锁定状态并将 EA 设为“暂停”。你需要**再次点击**按钮将其切换为“运行中”，如果满足开单条件（均线/间距等），下一秒就会开单。

---

---

## 🔧 6. 全参数详解与稳健配置指南

本章节详细解读 EA 的所有输入参数。为了确保您的交易**稳健恒久**，我们在每个参数后都附带了“稳健场景”的配置建议。

### 6.1 🏗️ 基础与产品架构 (Product & Tier)

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpUsePreset** | 使用内置预设 | **true (开启)** | 强烈建议开启。开启后 EA 会自动根据品种加载经过回测的优选参数（如黄金的斐波那契数列、欧美的线性递增），避免小白乱设参数导致爆仓。 |
| **InpProductType** | 产品类型 | **根据品种选择** | 必须选对品种（如跑黄金选 `PRODUCT_GOLD`）。系统会根据此选项读取 `ProductPresets.mqh` 中的波动率模型。 |
| **InpEnableSession** | 交易时段过滤 | **true (开启)** | 建议开启。默认避开亚盘清淡期（点差大）或特定风险时段。 |
| **InpAutoTier** | 自动资金层级 | **false (关闭)** | 建议手动控制层级，避免因为出金导致层级突然降级。 |
| **InpCapitalTier** | 资金/策略层级 | **TIER_SOLDIER** | **核心选项**。<br>• `TIER_BERSERK`: 狂暴模式（赌博，慎用）。<br>• `TIER_SOLDIER`: 特种兵（稳健，推荐）。<br>• `TIER_WHALE`: 鲸鱼（机构，低杠杆）。 |

### 6.2 🛡️ 核心风控防火墙 (Risk Firewall)

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpEquityStopPct** | 硬止损比例(%) | **20.0 - 25.0** | **保命线**。当净值回撤达到本金的 25% 时，强制清仓关机。**稳健交易必须接受止损，切勿设为 100。** |
| **InpDailyLossPct** | 日内停机线(%) | **3.0 - 5.0** | **防上头线**。当日亏损超过本金 5% 时暂停交易，冷静一天。 |
| **InpMaxLayerPerSide** | 单边最大层数 | **12** | 限制单边最多开几单。稳健模式下 12 层足够覆盖 3000-5000 点的波动。 |
| **InpMaxAdversePoints** | 极限逆势点数 | **2000** | 当单边逆势超过 2000 点（20美金）时，禁止继续加仓，防止在极端单边中因加仓过重而死。 |

### 6.3 🌊 ATR 动态波动率适配 (Dynamic Grid)

> **原理**：行情波动大时，网格自动变宽；波动小时，网格自动变密。防止在直条大暴跌中接到飞刀。

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpUseATRGrid** | 启用 ATR 网格 | **true (必须开启)** | 稳健模式的核心。狂暴模式下会被强制关闭。 |
| **InpATRMode** | 动态计算模式 | **ATR_DIRECT** | `ATR_DIRECT`: 直接用 ATR 值乘以倍率计算间距。<br>`ATR_SCALE`: 基于基准 ATR 进行缩放。 |
| **InpATRTF** | ATR 时间周期 | **PERIOD_H1** | 1小时周期的 ATR 最能反映日内波动的真实强度。 |
| **InpATRPeriod** | ATR 计算周期 | **14** | 标准参数，取过去 14根 K线的平均波动。 |
| **InpATRMultiplier** | ATR 间距倍率 | **0.5 ~ 0.8** | **关键**。值越大，网格越稀疏，越安全。黄金建议 0.5，白银建议 0.8。 |
| **InpBaseATRPoints** | 基准 ATR 点数 | **1000** | 仅在 `ATR_SCALE` 模式下生效，作为缩放的基母。 |

### 6.4 🔢 仓位管理与马丁 (Martingale & Grid)

> **注意**：如果开启了 `InpUsePreset=true`，这里的很多参数会被预设值覆盖。但了解它们依然重要。

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpMartinMode** | 加仓倍率模式 | **MODE_FIBONACCI** | • `EXPONENTIAL`: 指数 (1, 2, 4...) 极激进。<br>• `FIBONACCI`: 斐波 (1, 1, 2, 3, 5...) **最稳健**，曲线平滑。<br>• `LINEAR`: 线性 (1, 2, 3...) 适合大资金。 |
| **InpMaxSingleLot** | 单笔最大手数 | **0.50** | 即使本金很大，也建议限制单笔上限，防止滑点和黑天鹅。 |
| **InpDecayStep** | 倍率衰减起始层 | **6** | 从第 6 层开始，降低加仓倍率，防止尾部仓位过重。 |
| **InpDecayMulti** | 衰减后倍率 | **1.1** | 衰减后的温和倍率。 |
| **InpGridExpansion** | 网格动态扩张 | **true (开启)** | **抗单神器**。随着层数增加，间距自动拉大（如 30, 35, 45, 60...）。越深越不容易成交，用空间换时间。 |

### 6.5 🏦 机构级与对冲功能 (Institutional & Hedge)

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpEnableDualMode** | 双向同时持仓 | **true** | 允许同时持有多单和空单，利用震荡市双吃。 |
| **InpBEProfitPips** | 保本触发点数 | **80** | 盈利 80 微点后，自动把止损挂到成本价，确保这单不亏。 |
| **InpEnableDualHedge**| 首尾对冲 | **true** | **解套利器**。当层数较多时，用最新一单的盈利去抵消最远一单的亏损，降低持仓均价。 |
| **InpDestockMinLayer**| 对冲启动层数 | **6** | 持仓超过 6 层才开始尝试首尾对冲。 |

### 6.6 🛡️ 动态止盈 (Dynamic TP)

> **V4.7 核心**：根据持仓风险自动降低止盈期望。仓位越重，越只想“保本出局”。

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpUseDynamicTP** | 启用动态止盈 | **true** | 必须开启。 |
| **InpDynamicStart** | 防御模式触发层 | **4** | 持仓达到 4 层时，进入“防御模式”，止盈目标打折。 |
| **InpDynamicRatio** | 防御止盈折扣 | **0.5** | 防御模式下，止盈金额减半（只赚一半就跑）。 |
| **InpSurvivalStart** | 逃生模式触发层 | **7** | 持仓达到 7 层，进入“逃生模式”。 |
| **InpSurvivalProfit** | 逃生目标金额($) | **5.0** | 逃生模式下，只要总账赚 5 美金就全平，**只求活着**。 |

### 6.7 ⚙️ 核心参数 (Core)

| 参数名 | 中文释义 | 稳健场景建议 | 功能描述 |
| :--- | :--- | :--- | :--- |
| **InpTargetPips** | 基础止盈点数 | **150** | 首单的预期盈利点数。 |
| **InpSingleSideMaxLoss**| 单边最大亏损 | **500.0** | (辅助风控) 单边浮亏金额超过从值时，禁止加仓。 |
| **InpInitialLots** | 起始手数 | **0.01** | **勿贪**。稳健策略永远从 0.01 起步。 |
| **MartinMulti** | 手动马丁倍率 | **1.5** | 仅在不开预设时生效。 |
| **GridMinDist** | 首层间距 | **100** | 第一单和第二单的间距（微点）。100=1美金(黄金)。 |
| **GridDistLayer2** | 后续间距 | **300** | 第二层之后的标准间距。配合 ATR 会自动变大。 |

---

## 📈 7. 行情场景与战术建议

### 场景 A：亚盘震荡 / 垃圾时间 (08:00 - 15:00)
*   **特征**：波动小，区间窄。
*   **配置**：可尝试 **狂暴模式 (Tier 0)**，但必须有人值守。
*   **逻辑**：利用极窄网格（35微点）快速刷单。

### 场景 B：稳健持仓 / 每日主力 (推荐)
*   **特征**：无论是欧美盘还是数据行情，均能适应。
*   **配置**：**特种兵 (Tier 2)** + **InpUsePreset=true**。
*   **逻辑**：斐波那契加仓 + ATR 动态网格 + 7层逃生模式。这是让账户活过半年的最佳配置。

### 场景 C：深度被套 / 极限救援
*   **特征**：单边已经 10 层，浮亏巨大。
*   **配置**：
    1.  手动点击面板 **Stop/Pause** 按钮暂停开新单。
    2.  观察 **InpSurvivalProfit** 是否生效（查看面板底部的“目标”栏是否变红）。
    3.  耐心等待回调。一旦行情回头，触发 $5 止盈线会瞬间全平。
    4.  **切忌**：在浮亏巨大时手动加仓（锁上加锁），除非你非常确信那是大底。

---
